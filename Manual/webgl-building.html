<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '///gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https:///css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="构建和运行 WebGL 项目 - Unity 手册">
<title>构建和运行 WebGL 项目 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2021.2/uploads/Main/WebGLBuilding-BuildPlayerOptions.png">
<meta name="description" content="Build 文件夹包含以下文件（[ExampleBuild] 表示目标构建文件夹的名称）：">
<meta property="og:description" content="Build 文件夹包含以下文件（[ExampleBuild] 表示目标构建文件夹的名称）：">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'webgl-building';
      if(!page) page = 'index';
      var version = '2021.2';
      var docs_versions = [{version: '2022.1',version_string: '2022.1',supported: true},{version: '2021.3',version_string: '2021.3',supported: true},{version: '2021.2',version_string: '2021.2',supported: false},{version: '2021.1',version_string: '2021.1',supported: false},{version: '2020.3',version_string: '2020.3',supported: true},{version: '2020.2',version_string: '2020.2',supported: false},{version: '2020.1',version_string: '2020.1',supported: false},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: false},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2021.2/Manual/webgl-building.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2021.2/Manual/webgl-building.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2021.2/Manual/webgl-building.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2021.2/Manual/webgl-building.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2021.2/Manual/webgl-building.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2021.2/Manual/webgl-building.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2021.2/Manual/webgl-building.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2021.2/Documentation/Manual/webgl-building.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="///ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.2</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/webgl-building.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/webgl-building.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/webgl-building.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/webgl-building.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/webgl-building.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/webgl-building.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/webgl-building.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/webgl-building.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/webgl-building.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/webgl-building.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/webgl-building.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/webgl-building.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/webgl-building.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/webgl-building.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/webgl-building.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/webgl-building.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/webgl-building.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/webgl-building.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/webgl-building.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/webgl-building.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2021.2/Documentation/Manual/webgl-building.html">English</a></li>
<li><a data-lang="cn" href="/cn/2021.2/Manual/webgl-building.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2021.2/Manual/webgl-building.html">日本語</a></li>
<li><a data-lang="es" href="/es/2021.2/Manual/webgl-building.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2021.2/Manual/webgl-building.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2021.2/Manual/webgl-building.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2021.2</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2022.1" href="/cn/2022.1/Manual/webgl-building.html">2022.1</a></li>
<li class="supported"><a class="docs_version_url_2021.3" href="/cn/2021.3/Manual/webgl-building.html">2021.3</a></li>
<li class=""><a class="docs_version_url_2021.2" href="/cn/2021.2/Manual/webgl-building.html">2021.2</a></li>
<li class=""><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/webgl-building.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.3" href="/cn/2020.3/Manual/webgl-building.html">2020.3</a></li>
<li class=""><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/webgl-building.html">2020.2</a></li>
<li class=""><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/webgl-building.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/webgl-building.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/webgl-building.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/webgl-building.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/webgl-building.html">2019.1</a></li>
<li class=""><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/webgl-building.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/webgl-building.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/webgl-building.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/webgl-building.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/webgl-building.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/webgl-building.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/webgl-building.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/webgl-building.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/webgl-building.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p>包含此页的版本：</p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p>不含此页的版本：</p></li></div>
</ul>
<ul class="description">
<li>
<div class="supported-box"></div>受支持</li>
<li>
<div class="legacy-box"></div>旧版</li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual 2021.2</a></li>
<li><a href="PlatformSpecific.html">平台开发</a></li>
<li><a href="webgl.html">WebGL</a></li>
<li>构建和运行 WebGL 项目</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="webgl-networking.html"></a></span><div class="tip">WebGL 网络</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="webgl-templates.html"></a></span><div class="tip">使用 WebGL 模板</div>
</div>
</div></div>
<h1>构建和运行 WebGL 项目</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p><code>Build</code> 文件夹包含以下文件（<code>[ExampleBuild]</code> 表示目标构建文件夹的名称）：</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">文件名</th>
	<th style="text-align:left;">包含</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].loader.js</code></td>
	<td style="text-align:left;">网页需要用来加载 Unity 内容的 JavaScript 代码。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].framework.js</code></td>
	<td style="text-align:left;">JavaScript 运行时和插件。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].wasm</code></td>
	<td style="text-align:left;">WebAssembly 二进制文件。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].mem</code></td>
	<td style="text-align:left;">用于初始化播放器堆内存的二进制映像文件。Unity 仅针对多线程 WebAssembly 构建生成此文件。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].data</code></td>
	<td style="text-align:left;">资源数据和场景。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].symbols.json</code></td>
	<td style="text-align:left;">调试错误堆栈跟踪所需的调试符号名称。仅当启用 Debug Symbols 选项时 (<strong>File</strong> &gt; <strong>Build Settings</strong> &gt; <strong>Player Settings</strong>)，才会为 Release 构建生成此文件。</td>
</tr>
<tr>
	<td style="text-align:left;"><code>[ExampleBuild].jpg</code></td>
	<td style="text-align:left;">在构建加载时显示的背景图像。仅当在 Player Settings (<strong>File</strong> &gt; <strong>Build Settings</strong> &gt; <strong>Player Settings</strong> &gt; <strong>Splash Image</strong>) 中提供了背景图像时，才会生成此文件。有关更多信息，请参阅启动画面页面。</td>
</tr>
</tbody>
</table>

<p>如果对构建启用某种<strong>压缩方法</strong>，Unity 会识别与压缩方法对应的扩展名，并将此扩展名添加到 Build 子文件夹中的文件的名称中。如果启用 <strong>Decompression Fallback</strong>，Unity 将扩展名 <code>.unityweb</code> 附加到构建文件名。否则，Unity 为 Gzip 压缩方法附加扩展名 <code>.gz</code>，或者为 Brotli 压缩方法附加扩展名 <code>.br</code>。
有关更多信息，请参阅 <a href="webgl-deploying.html">WebGL：压缩构建和服务器配置</a>。</p>

<p>如果启用 <strong>Name Files As Hashes</strong>（在 <strong>Player Settings</strong> 中），Unity 使用文件内容的哈希值而不是默认文件名。这适用于构建文件夹中的每个文件。如果选择此选项，可以将游戏构建的更新版本上传到服务器上的同一文件夹中，并且仅上传在版本迭代之间发生更改的文件。</p>

<p>在本地查看 WebGL Player 的最佳方式是使用 Unity 的 <strong>Build And Run</strong> 选项（菜单：<strong>File</strong> &gt; <strong>Build And Run</strong>）。Unity 使用本地 Web 服务器来托管您的构建，并从本地主机 URL 打开它。或者，可以使用正确配置了响应标头的自定义本地 Web 服务器。有关设置响应标头的更多信息，请参阅 <a href="webgl-deploying.html">WebGL：压缩构建和服务器配置</a>。</p>

<p><strong>注意</strong>：在某些浏览器中可能无法直接从文件系统打开播放器。这是由于本地文件 URL 应用了安全限制。</p>

<h2>Build Settings</h2>

<p>要访问 WebGL 构建设置，请打开 Build Settings 窗口 (<strong>File</strong> &gt; <strong>Build Settings</strong>)。然后，从 Platform 列表中选择 <strong>WebGL</strong>。</p>

<figure>
<img src="../uploads/Main/WebGLBuilding-BuildPlayerOptions.png" alt="Build Settings 窗口">
<figcaption>Build Settings 窗口</figcaption>
</figure>

<h3>Development Build</h3>

<p>选择 <strong>Development Build</strong> 设置时，Unity 会生成一个支持性能分析器的开发版和一个可供您查看应用程序中任何错误的开发控制台。此外，开发版不会缩减内容。开发版中的 JavaScript 是人类可读格式，而且 Unity 将保留函数名称，以便您可以查看错误的堆栈跟踪。但是，这意味着开发版将非常大，导致无法分发。
仅当启用了 Development Build 设置时，才能选择 <strong>Autoconnect Profiler</strong> 和 <strong>Deep Profiling Support</strong>。</p>

<h3>Autoconnect Profiler</h3>

<p>启用 <strong>Autoconnect Profiler</strong> 设置可分析 Unity WebGL 内容的性能。对于 WebGL，无法像在其他平台上那样将<a href="#Profiler">性能分析器</a>连接到正在运行的构建，因此必须使用此选项将内容连接到 Editor。这是因为性能分析器连接是使用 WebGL 上的 WebSockets 处理的，但 Web 浏览器仅允许来自内容的传出连接。</p>

<h3>Deep Profiling Support</h3>

<p>启用 <strong>Deep Profiling Support</strong> 设置可使 Unity Profiler 对应用程序中的每次函数调用都进行性能分析。如需了解更多信息，请参阅有关<a href="ProfilerWindow.html#deep-profiling">深度性能分析</a>的文档。</p>

<h2>播放器设置 (Player settings)</h2>

<p>WebGL 在 <a href="class-PlayerSettingsWebGL.html">Player 设置</a>（菜单：__Edit__ &gt; <strong>Project Settings__，然后选择 </strong>Player__ 类别）中有一些其他选项。</p>

<h3>Other Settings</h3>

<figure>
<img src="../uploads/Main/WebGLBuilding-OtherSettings.png" alt="">
</figure>

<h4>Strip Engine Code</h4>

<p>打开 <strong>Other Settings</strong> 访问 <strong>Strip Engine Code</strong> 选项。默认情况下会选中此选项以启用 WebGL 的代码剥离。选中此选项后，Unity 不会包含未使用的任何类的代码。例如，如果不使用任何物理组件或函数，则会从构建中删除整个物理引擎。有关更多详细信息，请参阅下面的“剥离”部分。</p>

<h3>Publishing Settings</h3>

<figure>
<img src="../uploads/Main/WebGLBuilding-PublishingSettings.png" alt="">
</figure>

<h4>Enable Exceptions</h4>

<p>打开 <strong>Publishing Settings</strong> 访问 <strong>Enable Exceptions</strong>。<strong>Enable Exceptions</strong> 允许指定在运行时如何处理意外的代码行为（通常视为错误）。该设置具有以下选项：</p>

<ul>
<li>__None__：如果不需要任何异常支持，请选择此选项。此选项可提供最佳性能和最小构建。使用此选项，抛出的任何异常都会导致内容因该设置中的错误而停止。</li>
<li>__Explicitly Thrown Exceptions Only__（默认设置）：选择此选项可捕获从脚本中的 <code>throw</code> 语句显式指定的异常，并可确保调用 <code>finally</code> 代码块。请注意，选择此选项会使脚本中生成的 JavaScript 代码变得更长且更慢；仅当脚本是项目的主要瓶颈时，这才会成为问题。</li>
<li>__Full Without Stacktrace__：选择此选项可捕获：

<ul>
<li>从脚本中的 <code>throw</code> 语句显式指定的异常（与 <em>Explicitly Thrown Exceptions Only</em> 选项一样）</li>
<li>Null 引用</li>
<li>越界数组访问</li>
</ul>
</li>
<li>__Full With Stacktrace__：此选项与上面的选项类似，但也捕获堆栈跟踪。Unity 通过在代码中嵌入对异常检查来生成这些异常，因此该选项会降低性能并增加浏览器内存使用量。仅用于调试，并始终在 64 位浏览器中进行测试。</li>
</ul>

<p>选择 <strong>Publishing Settings</strong> 以访问__数据缓存__。</p>

<h2>数据缓存</h2>

<p>要访问<strong>数据缓存</strong>，请选择 <strong>Publishing Settings</strong> (<strong>File</strong> &gt; <strong>Build Settings</strong> &gt; <strong>Player Settings</strong> &gt; <strong>WebGL</strong> &gt; <strong>Publishing Settings</strong>)。这样，浏览器会将主数据文件缓存到 IndexedDB 数据库中。</p>

<p>使用默认浏览器 HTTP 缓存并不能保证浏览器缓存特定响应。这是因为浏览器 HTTP 缓存空间有限，浏览器可能无法缓存过大的文件。</p>

<p>为了提高加载速度，IndexedDB 允许您缓存超过浏览器限制的文件。缓存更多文件时，下一次构建运行期间下载内容在用户计算机上可用的机会就增加了。</p>

<p>数据缓存仅为 HTTP 响应缓存 IndexedDB 缓存中的 <code>.data</code> 文件。要缓存资源包，需要启用数据缓存并覆盖 <code>unityInstance.Module.cacheControl()</code>。
为此，请确保 <code>Module.cacheControl(url)</code> 为请求的资源包 URL 返回 <code>must-revalidate</code>。例如，您可以在 createUnityInstance() 返回的 Promise 的执行回调中重写 unityInstance.Module.cacheControl() 函数。
有关 createUnityInstance() 的更多信息，请参阅 <a href="webgl-deploying.html">WebGL：压缩构建和服务器配置</a>。</p>

<p>以 WebGL 为目标进行发布时，必须保持较低的构建大小，让用户在内容启动之前等待合理的下载时间，这一点很重要。有关减小资源大小的一般提示，请参阅<a href="ReducingFilesize.html">减小构建文件大小</a>相关文档。</p>

<h2>分发大小</h2>

<p>以 WebGL 为目标进行发布时，必须保持较低的构建大小，让用户在内容启动之前等待合理的下载时间，这一点很重要。有关减小资源大小的一般提示，请参阅<a href="ReducingFilesize.html">减小构建文件大小</a>相关文档。</p>

<h3>WebGL 特有的提示和技巧</h3>

<ul>
<li><p>在<a href="class-TextureImporter.html">纹理导入器 (Texture Importer)</a> 中为所有压缩纹理指定 <strong>Crunch</strong> 纹理压缩格式。</p></li>
<li><p>不要部署开发版本；它们不会经过压缩或<a href="https://en.wikipedia.org/wiki/Minification_%28programming%29">缩小</a>，因此文件大小要大得多。</p></li>
<li><p>打开 <strong>Player</strong> 设置（菜单：__Edit__ &gt; <strong>Project Settings__，然后选择 </strong>Player__ 类别），打开 <strong>Publishing Settings</strong> 面板，并将 <strong>Enable Exceptions</strong> 设置为 __None__（如果在构建中不需要异常）。</p></li>
<li><p>打开 <strong>Player</strong> 设置（菜单：__Edit__ &gt; <strong>Project Settings__，然后选择 </strong>Player__ 类别），打开 <strong>Other Settings</strong> 面板，然后启用 <strong>Strip Engine Code</strong> 以确保进行高效构建。</p></li>
<li><p>使用第三方托管的 dll 时要小心，因为它们可能包含大量依赖项，所以会显著增加生成的代码大小。</p></li>
</ul>

<p>如果要构建发布版本，Unity 将根据在 WebGL <strong>Player</strong> 设置的 <strong>Publishing Settings</strong> 面板中选择的 <strong>Compression Format</strong> 来压缩构建输出文件。</p>

<figure>
<img src="../uploads/Main/WebGLBuilding-CompressionFormat.png" alt="">
</figure>

<p>有关这些选项的更多信息以及如何使用它们发布构建，请参阅有关<a href="webgl-deploying.html">部署压缩构建</a>的文档。</p>

<h2>AssetBundle</h2>

<p>由于所有资源数据都需要在内容启动之前预先下载，因此应考虑将资源从主数据文件中移出到 <a href="AssetBundlesIntro.html">AssetBundle</a>中。这样，就能为内容创建一个小型加载场景，确保快速加载。然后，当用户继续浏览内容时，将按需动态加载资源。AssetBundle 还有助于进行<a href="webgl-memory.html">资源数据内存</a>管理：可通过调用 <a href="../ScriptReference/AssetBundle.Unload.html">AssetBundle.Unload</a> 从内存中卸载掉不再需要的资源的资源数据。</p>

<p>在 WebGL 平台上使用 AssetBundle 时的注意事项：</p>

<ul>
<li><p>在 AssetBundle 中使用未在主构建中使用的类类型时，Unity 可能会从构建中剥离这些类的代码。尝试从 AssetBundle 加载资源时，这可能会导致失败。请使用 <a href="../ScriptReference/BuildPlayerOptions-assetBundleManifestPath.html">BuildPlayerOptions.assetBundleManifestPath</a> 修复该问题，或参阅下面有关<em><a href="#Stripping">剥离</a></em>的部分以了解其他选项。</p></li>
<li><p>WebGL 不支持线程，但 http 下载内容仅在下载完成后才可用。因此，在下载完成时，Unity WebGL 构建需要在主线程上解压缩 AssetBundle 数据，而这会阻止主线程。为避免这种中断，<a href="AssetBundles-Building.html">LZMA AssetBundle 压缩</a>不可用于 WebGL 上的 AssetBundle。此情况下使用 LZ4 对 AssetBundle 进行压缩，这种压缩格式可非常高效地按需进行解压缩。如果所需的压缩大小比 LZ4 能够提供的压缩大小更小，可将 Web 服务器配置为对 AssetBundle 使用 gzip 或 Brotli 压缩（基于 LZ4 压缩）。请参阅有关<a href="webgl-deploying.html">部署压缩构建</a>的文档以详细了解如何执行此操作。</p></li>
<li><p>WebGL supports AssetBundle caching with <a href="../ScriptReference/Networking.UnityWebRequestAssetBundle.GetAssetBundle.html">UnityWebRequestAssetBundle.GetAssetBundle</a>. This method uses the IndexedDB API from your browser to store a cache on the user’s device. Some browsers might have limited support for IndexedDB and any browsers might request the user’s authorization to store data on the disk. For more information, see <a href="webgl-browsercompatibility.html">WebGL browser compatibility</a>.</p></li>
</ul>

<p><a name="Stripping"></a> </p>

<h2><strong>剥离</strong></h2>

<p>默认情况下，Unity 会从构建中删除所有未使用的代码。可通过 <strong>Player</strong> 设置（菜单：__Edit__ &gt; <strong>Project Settings__，然后选择 </strong>Player__ 类别）来更改此设置：选择 <strong>Other Settings</strong> 面板访问 <strong>Strip Engine Code</strong> 选项。最好在启用剥离的情况下进行构建。</p>

<p>启用代码剥离后，Unity 扫描会项目以查找是否使用了 <code>UnityObject</code> 派生的任何类（通过在脚本代码中或在场景中的序列化数据中引用）。然后从构建中删除所有未使用这些类的 Unity 子系统。这样可减少构建代码，从而减小下载和要解析的代码（因此代码运行速度更快，且占用的内存更少）。</p>

<h2>代码剥离的问题</h2>

<p>如果代码剥离时剥离了实际需要的代码，可能会导致项目出现问题。例如，如果在运行时加载的 AssetBundle 所包含的类未包括在主构建中，因此从项目中删除了这些 AssetBundle，这种情况下就可能出问题。发生这种情况时，浏览器的 JavaScript 控制台中会显示错误消息（随后可能会显示更多错误）。例如：</p>

<p><code>Could not produce class with ID XXX</code></p>

<p>要解决这些错误，请在<a href="ClassIDReference.html">类 ID 参考</a>中查找该 ID（如上例中的 <code>XXX</code>），看哪个类在尝试创建实例。在这种情况下，可强制 Unity 在构建中包含该类的代码，方法是向脚本或向场景添加对该类的引用，或者在项目中添加 <code>link.xml</code> 文件。</p>

<p>下面的示例确保了 Collider 类（因此也包括 Physics 模块）在项目中得到保留。可将此 XML 代码添加到名为 <code>link.xml</code> 的文件，然后将该文件放入 <em>Assets</em> 文件夹。</p>

<pre><code>&lt;linker&gt;
    &lt;assembly fullname="UnityEngine"&gt;
        &lt;type fullname="UnityEngine.Collider" preserve="all"/&gt;
    &lt;/assembly&gt;
&lt;/linker&gt;

</code></pre>

<p>如果怀疑剥离导致构建出现问题，还可尝试在测试期间禁用 <strong>Strip Engine Code</strong> 选项。</p>

<p>通过查看构建中包含哪些模块和类可以优化项目的剥离功能，但 Unity 未提供方便的方法来进行此操作。不过，若要了解包含的类和模块的概况，可在进行构建之后查看生成的文件 <code>Temp/StagingArea/Data/il2cppOutput/UnityClassRegistration.cpp</code>。</p>

<p>请注意，__Strip Engine Code__ 选项仅影响 Unity 引擎代码。IL2CPP 始终会从托管的 dll 和脚本中剥离字节代码。需要通过反射（而不是通过代码中的静态引用）来动态引用托管的类型时，这可能会导致问题。如果需要通过反射来访问类型，可能还需要设置 <code>link.xml</code> 文件才能保留这些类型。请参阅有关 <a href="iphone-playerSizeOptimization.html">iOS 构建大小优化</a>的文档页面以了解关于 <code>link.xml</code> 文件的更多信息。</p>

<h2>移动构建输出文件</h2>

<p>要更改 <code>Build</code> 文件夹的位置，请修改 WebGL 模板 index.html 文件中的 buildUrl 变量。</p>

<p>要更改 <code>Build</code> 文件夹内的文件的位置，请在 index.html 文件中更改它们的 URL（即 <code>dataUrl</code>、<code>wasmCodeUrl</code>、<code>wasmMemoryUrl</code> 和 <code>wasmFrameworkUrl</code>）。</p>

<p>如果要在内容分发网络 (CDN) 上托管文件，可指定位于外部服务器上的 URL，但需要确保托管服务器已启用跨源资源共享 (CORS) 才能保证正常工作。有关 CORS 的更多信息，请参阅手册中的 <a href="webgl-networking.html">WebGL 网络</a>页面。</p>

<h2>增量构建</h2>

<p>IL2CPP 为项目生成的 C++ 代码采用增量编译方式；也就是说，只有自上次构建以来生成的已更改的 C++ 代码才会再次编译。未更改的源代码将重复使用先前构建所生成的相同目标文件。用于增量式 C++ 构建的目标文件存储在 Unity 项目的 <code>Library/il2cpp_cache</code> 目录中。</p>

<p>要对生成的 C++ 代码执行从头开始的全新构建而不使用增量编译，请删除 Unity 项目中的 <code>Library/il2cpp_cache</code> 目录。请注意，如果 Unity 编辑器版本与以前的 WebGL 构建版本不同，Unity 会自动从头开始执行全新的构建。</p>

<hr>

<ul>
<li><span class="page-history">在 Unity 2017.3 中添加了 Full Without Stacktrace</span></li>
<li>
<span class="page-history">在 Unity 2019.1 中删除了 asm.js 链接器目标</span>
*<span class="page-history">Unity 2020.1 中添加了构建文件更新和数据缓存</span>
</li>
</ul>
<!-- area:platforms -->
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="webgl-networking.html"></a></span><div class="tip">WebGL 网络</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="webgl-templates.html"></a></span><div class="tip">使用 WebGL 模板</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2021 Unity Technologies. Publication 2021.2</div>
<div class="menu">
<a href="https://learn.unity.com/">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
